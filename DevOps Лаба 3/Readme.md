# Лабораторная работа № 3

## Задание
* Написать “плохой” CI/CD файл, который работает, но в нем есть не менее пяти “bad practices” по написанию CI/CD
* Написать “хороший” CI/CD, в котором эти плохие практики исправлены

## Выполнили человеки
* Усольцева Дарья
* Забродский Александр
* Азатжонова Мехринисо

## Начинаем делать лабу
Мы, когда только открыли лабу и пытаемся понять, кто такие CI/CD:

<img src="https://github.com/user-attachments/assets/eb5500fe-d5f9-4847-a300-27ea27a2cf1a" width="350" />
<img src="https://github.com/user-attachments/assets/d5c14963-b23c-48a7-88f7-c07a398e13a8" width="350" />

## Выполнение лабы
Для начала разбираемся как писать CI/CD файл, узнаем про его структуру/компоненты.

### Bad practices
Рассмотрим файл CI/CD, в котором представлены "плохие практики", более подробно, чтобы для начала разобрать принцип  работы CI/CD. 


Первоначально мы задаем название пайплана, в нашем случае это `Bad practices in CI/CD`. Далее указываем триггеры(компонент `on`), то есть когда должнен запускаться CI/CD, например, при внесении изменений в ветку `main`:

![image](https://github.com/user-attachments/assets/61718774-2659-4637-9dd7-e5ccedbad595)


В `jobs` прописываем два основных задания: `build`,  `deploy`. 

#### Задание `build`
В данной задаче мы определяем операционную систему `ubuntu-22.04`, на которой будет происходить выполенение. Далее описываем  отдельные шаги: `Checkout code`, отвечающий за актуальность кода, `Install dependencies`, устанавливающий все необходимые для работы библиотеки/пакеты из файла `package.json`, `Run tests` для тестирования на проверку логики всего приложения и, наконец, `Build application` для сборки приложения/подготовки к развертыванию:

![image](https://github.com/user-attachments/assets/03629cdc-a714-4522-9edd-7845ebe87fa8)


#### Задание `deploy`
Аналогично с предыдущим заданием выполняется на системе `ubuntu-22.04` и содержит шаг `Checkout code` для получения актуального кода. Шаг `Deploy application` содержит команду `./deploy.sh`, которая и выполняет скрипт развертывания приложения:

![image](https://github.com/user-attachments/assets/fd82117e-aacc-4f43-96aa-eca904ca79e0)


Плохие практики, которые представлены в описанном выше файле:
1. Объединение сборки и тестирования в одном большом задании может усложнить отладку возникающих ошибок(на каком шаге возникли ошибки)
2. Отсутствие кеширования, что приводит к замедлению работы CI/CD за счет необходимости устанавливать библиотеки/пакеты заново каждый раз
3. Отсутствие зависимостей/связей между `build` и `deploy`, что может привести к запуску неподтвержденного кода, т.е. выполенению развертки после неудачного тестирования
4. Неоптимальное использование  команды `actions/checkout@v3`(повторяется 2 раза), что приводит к увеличению времени выполнения и требованию дополнительных ресурсов
5. Отсутствие ораничения времени выполнения этапов, что приводит к увеличению рисков зависания и ухудшению предсказуемости работы

### Good practices или как мы исправили Bad practices

1. Для исправления первой плохой практики мы разбили `build`  и `tests` на отдельные этапы. Код стал более понятным и простым для отладки в случае ошибок, а также это повлияло на его гибкость, то есть упростило добавление/изменение этапов, их возможное повторное использование.

![image](https://github.com/user-attachments/assets/ef57b3dd-19ce-464f-ba02-03b9abd1f0e7)



2. Было добавлено кеширование зависимостей `npm`, что позволило не скачивать зависимости заново при каждой сборке, если файл `package-lock.json` не изменился. В результате значительно  повысилась эффективность CI/CD за счет уменьшения времени выполнения, а также экономии ресурсов(памяти).

![image](https://github.com/user-attachments/assets/ee3ef03b-c4ee-459c-a501-9fb8ea4fb743)


3. Были выстроены связи между `build` и `tests`, а также между `tests` и `deploy`, что обеспечило выполнение тестирования только после успешного завершения сборки и выполнения развертки после окончания всех тестов.

![image](https://github.com/user-attachments/assets/53860d4b-4c62-4bc3-9b84-024b2c0e3816)


![image](https://github.com/user-attachments/assets/15c67a31-feb3-40fc-a0f5-60b112236656)


4. В исправленном варианте команда `actions/checkout@v3 повторяется только один раз на этапе сборки, установленные зависимости между сборкой, тестрированием и разверткой(пункт 3) позволили сократить ее использование, что в свою очередь повысило эффективность выполенения всей работы(уменьшение затраченного времени/ресурсов).

5. Для каждого этапа был установлен `timeout-minutes: 30`, благодаря чему появляется возможность контролировать время выполнения и предотвращать зависание на неопределенное/долгое время, что позволяет быстрее реагировать на сбои и делает выполнение каждого этапа более надежным и эффективным.

![image](https://github.com/user-attachments/assets/b1c7f273-e6c1-4e48-afff-1dc7208d9fb9)

![image](https://github.com/user-attachments/assets/1096ad3c-0675-44a4-b92a-e2de0b948dc3)

![image](https://github.com/user-attachments/assets/06b0a87a-4653-4f65-b2dd-bf1984fe3c41)


CI/CD файлы были запущены, скрины из Github Actions представлены ниже:

**Bad practices:

![image](https://github.com/user-attachments/assets/5b1626d0-9229-4e22-a63c-ca637f6b0fdf)

![image](https://github.com/user-attachments/assets/8e608f3b-0e78-4536-882d-9430842bc2c9)

**Good practices:
![image](https://github.com/user-attachments/assets/1d38c187-538e-4e51-9ea0-47d93921de3f)

![image](https://github.com/user-attachments/assets/271200a7-244a-4eac-9116-a13e50beb160)
![image](https://github.com/user-attachments/assets/436eaf2e-cb08-4dce-9924-9d1899106ca1)



### История про Васю
Мы до прочтения истории про Васю:

<img src="https://github.com/user-attachments/assets/2a50b505-a46c-44de-8252-6744e734130f" width="350" />

Мы после прочтения истории про Васю:

<img src="https://github.com/user-attachments/assets/91a17b86-54a2-4671-b32e-04619a0bd791" width="350" />


### Заключение
1. "Плохой" CI/CD файл мы написали
2. "Хороший" CI/CD файл мы написали
3. 5 bad practices мы объяснили
4. Исправленные 5 bad practices мы тоже объяснили

А значит лаба выполнена!

## Это мы отдыхаем

<img src="https://github.com/user-attachments/assets/2ddf8f26-99a0-4690-9840-278297445372" width="350" />


